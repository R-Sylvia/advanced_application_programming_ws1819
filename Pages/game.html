<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="author" content="Anna Lukjanenko" />
    <meta name="description" content="Advanced Software Programming" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
    </style>
    <link href="gameStylesheet.css" rel="stylesheet" />
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <title>GrabIT Game page</title>
</head>
<body>
    <div class="wrapper">
        <div class="titlegrid" style="min-height:40px">
            <div class="title">Let's Play Grab <letterspace style="letter-spacing:10px">IT</letterspace></div>
            <div class="registrationgrid">
                <button class="button" type="button" onclick="window.location.href='menu.html'">Ex <letterspace style="letter-spacing:5px">IT</letterspace></button>
            </div>
        </div>
        <div class="scoreboard"><strong>SCOREBOARD</strong>
            <div class="table">
                <div class="scoreentry" id="scoreentry">
                </div>
            </div>
        </div>
        <div class="chatbox">
            <div class="chatlogs">
                <div class="chatentry" id="chatentry"></div>
            </div>
        </div>
        <form class="chatform" id="chatform">
            <textarea class="form-control" id="message"></textarea>
            <input type="submit" class="SendBtn" value="Send" />
        </form>
        <div class="canvas">
            <canvas class="canvas"></canvas>
            <script src="canvas.js"></script>
        </div>
    </div>
    <script>
        //var socket = io.connect();
        var $chatform = $('#chatform');
        var $message = $('#message');
        var $chatentry = $('#chatentry');
        var $scoreentry = $('#scoreentry');
       
        //Client presses "Send" button for sending the message
        $chatform.submit(function (e) {
            e.preventDefault();
            socket.emit('chat message', $message.val());
            $message.val('');
        });
        //SERVER SIDE CODE
        
        //Send Message
        socket.on('chat message', function (data) {
            io.sockets.emit('new message', { msg: data, user: socket.username });
        });
        

        //Receiving new message and displaying it
        socket.on('new message', function (data) {
            $chatentry.append('<p class="username"><strong>' + data.user + '</strong>:</p>');
            $chatentry.append('<p class="usermessage">' + data.msg + '</p>');
        });

        //Receiving "update scoreboard" message from server
        //socket.on('update scoreboard', function (data) {
            var html = '';
            for (i = 1; i <= data.length; i++) {
                html += '<p class="score">' + (i + 1) + '.  ' + data[i].user + '  ' + data[i].msg + '</p>';
            }
            $scoreentry.html(html);
        });
        //SERVER SIDE CODE
        
        //Score has changed of current players
        socket.on('score changed', function (score) {
            //update list of current players and its scores
            //update DB
            //update scoreboard
            io.sockets.emit('update scorboard', {listCurrentPlayers});
        });
    </script>
</body>
</html>